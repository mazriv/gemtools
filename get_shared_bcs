#!/bin/bash
#$ -cwd


#A script to run tools from the gemtools suite to support Brain TRI project
#By Mazdak Riverin and Trevor Pugh
#June 02, 2020

##################
# get_shared_bcs #
##################

#############
# ARGUMENTS #
#############

#To make this script generalizable, replace the following hard-coded arguments
#with commands to collect command-line arguments, i.e. $1=INDIR, $2=OUTDIR
INDIR='/.mounts/labs/TRI_Brain/production/191212_A00469_0071_AHWWMGDSXX/GBM618/outs/'
INDIR2='/.mounts/labs/TRI_Brain/pughlab/mazdak/GBM618/'
OUTDIR='/.mounts/labs/TRI_Brain/pughlab/mazdak/GBM618/'

###########################################################################################################################
#Determine barcodes shared between SV breakpoints for SV analysis using gemtools (for LR-WGS) on OICR's Univa Grid engine #
###########################################################################################################################

#module load gemtools as it is installed directly in the pughlab home directory via modulator.
module load conda        #on first time run of conda by each user, they need to run: "conda init"
module load gemtools/0.1 #also loads python/2.7.13 rstats-shlib-rpy2/3.3.3 gemtools-rlibs/0.1

#gemtools -T get_shared_bcs -i [out.bed] -b [LR_bam_file] -o [out.shared]

#Ex: gemtools -T get_shared_bcs -i large_sv_calls.bc_wndw.bed -b phased_possorted.bam -o out.shared.txt

#Input:
#-i output bed file from 'set_bc_window' tool (or custom bed file with relevant columns)
#-b bam file generated by Long Ranger
#Output:
#-o output file: List and count of SV-spanning barcodes for each SV event

gemtools -T get_shared_bcs \
		 -i $INDIR2/large_sv_calls_bc_wndw.bed \
		 -b $INDIR/phased_possorted_bam.bam \
		 -o $OUTDIR/out_shared.txt
